{% extends 'base.html' %}
{% load i18n %}
{% load static %}
{% load customfilters %}
{% load tz %}

{% block head %}
<link rel="stylesheet" href="{% static 'css/library.css' %}">
{% endblock %}

{% block navbar %}
<li class="nav-item">
  <a class="nav-link" href="{% url "library:addStory" %}" >{% trans "Add story" %}</a>
</li>
{% endblock %}

{% block body %}

<div class="row">
  <div class="dropdown col-12">
    <a class="btn btn-secondary dropdown-toggle" href="#" role="button"  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      {% trans "Sort by" %}
    </a>
    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
      <a class="dropdown-item {% ifequal sortChoice 'score'%} active {% endifequal %}" href="?sort=score&age={{ageChoice}}&language={{languageChoice}}">{% trans "Score" %}</a>
      <a class="dropdown-item {% ifequal sortChoice 'age'%} active {% endifequal %}" href="?sort=age&age={{ageChoice}}&language={{languageChoice}}">{% trans "Age category" %}</a>
      <a class="dropdown-item {% ifequal sortChoice 'pub_date'%} active {% endifequal %}" href="?sort=pub_date&age={{ageChoice}}&language={{languageChoice}}">{% trans "Most recent" %}</a>
      <a class="dropdown-item {% ifequal sortChoice 'title'%} active {% endifequal %}" href="?sort=title&age={{ageChoice}}&language={{languageChoice}}">{% trans "Title" %}</a>
      <a class="dropdown-item {% ifequal sortChoice 'uploader'%} active {% endifequal %}" href="?sort=uploader&age={{ageChoice}}&language={{languageChoice}}">{% trans "Author" %}</a>
    </div>
    <a class="btn btn-secondary dropdown-toggle" href="#" role="button"  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      {% trans "Language" %}
    </a>
    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
      {% for language in languageDict %}
      <a class="dropdown-item {% ifequal language langChoice %} active {% endifequal %}" href="?sort={{sortChoice}}&age={{ageChoice}}&language={{language}}"> {{ languageDict|get_item:language }}</a>
      {% endfor %}
      <a class="dropdown-item {% ifequal langChoice '' %} active {% endifequal %}" href="?sort={{sortChoice}}&age={{ageChoice}}"> {% trans "All" %}</a>
    </div>
    <a class="btn btn-secondary dropdown-toggle" href="#" role="button"  data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      {% trans "Age" %}
    </a>
    <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
      {% for age in ageDict %}
      <a class="dropdown-item {% ifequal age ageChoice %} active {% endifequal %}" href="?sort={{sortChoice}}&age={{age}}&language={{langChoice}}"> {{ ageDict|get_item:age }}</a>
      {% endfor %}
      <a class="dropdown-item {% ifequal ageChoice '' %} active {% endifequal %}" href="?sort={{sortChoice}}&language={{langChoice}}"> {% trans "All" %}</a>
    </div>
  </div>
</div>
{% if stories_list %}
{% for story in stories_list %}
{% if story.uploadReady %}
<div class="row story-line no-gutters">
  <div class="col-2">
    <img src="{{ story.poster.url }}" alt="{{ story.title }}" class = "poster img-fluid" />
  </div>
  <div class="col-10">
    <div class="content container-fluid">
      <div class="row">
	<div class="col-sm-12 col-12">  <a class="story-title" href={% url "library:watchStory" storyId=story.id %}>{{ story.title }}</a> </div>
	<div class="col-sm-12 col-12">  {{ story.abstract }}  </div>
	<div class="col-sm-3 col-6">  {{ ageDict|get_item:story.age }} </div>
	<div class="col-sm-3 col-6">  {{ languageDict|get_item:story.language }} </div>
	<div class="col-sm-3 col-6">  {% localtime off %}{{ story.pub_date.date }}{% endlocaltime %} </div>
	<div class="col-sm-3 col-6">  
	  <button class="vote {% if user in story.downvotes.all  %}selected{% endif %}" id="downvoteStory{{story.id}}" data-vote="down" data-storyid="{{story.id}}" type="button" {% if not user.is_authenticated %} disabled {% endif %}><span>-</span> </button><!--
	  --><span class="score" id="scoreStory{{ story.id }}">{{ story.score }}</span><!--
	  --><button class="vote  {% if user in story.upvotes.all  %}selected{% endif %}" id="upvoteStory{{story.id}}" data-vote="up" data-storyid="{{story.id}}" type="button" {% if not user.is_authenticated %} disabled {% endif %}> <span>+</span></button>
	</div>
	<div class="col-sm-12 col-12"> {% trans "by" %} {% if story.uploader %} {{ story.uploader.username }} {% else %} {% trans "a deleted user" %} {% endif %} <a href={{ story.storyFile.url }}>download</a>
	  <button class="toUserLib {% if user in story.inUserLibrary.all  %} selected {% endif %}" id="toUserLib{{story.id}}" data-storyid="{{story.id}}" type="button"
		  {% if not user.is_authenticated %}
		  disabled
		  {% endif %}
		  ><!--
		     --><svg version="1.1"  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
	   viewBox="-180 -180 1119.5 1119.5">
	<path d="M748.65,794c0.1-15-5.6-29.2-16.2-40c-10.6-10.7-24.8-16.6-39.8-16.6H72.85v112.1h618.7
		 C722.75,849.5,748.35,824.6,748.65,794z"/>
	<path d="M838.65,793.8c0.2-79.3-63.1-144.2-141.8-146.399H43.65c-13.8,0-25,11.199-25,25v10c0,13.8,11.2,25,25,25h649
		 c27.5,0,52.1,13,67.8,33.199c11.601,14.801,18.4,33.5,18.2,53.7c-0.2,19.5-7,37.4-18.2,51.7c-16,20.4-41.1,33.5-68.899,33.5H43.65
		 c-13.8,0-25,11.2-25,25v10c0,13.8,11.2,25,25,25h647.5C771.95,939.5,838.45,874.6,838.65,793.8z"/>
	<path d="M207.05,432c-10.6,10.7-16.4,24.9-16.2,40c0.3,30.6,25.9,55.5,57.1,55.5h618.7V415.4h-619.8
		 C231.85,415.4,217.75,421.3,207.05,432z"/>
	<path d="M895.85,325.4h-649c-80.7,0-146.3,65.7-146,146.5c0.2,79.3,64.4,143.3,143.2,145.6c1.4,0,651.8,0.1,651.8,0.1
		 c13.8,0,25-11.199,25-25v-10c0-13.8-11.2-25-25-25h-647.9c-27.9,0-52.9-13.1-68.9-33.5c-11.2-14.3-18-32.199-18.2-51.699
		 c-0.2-20.2,6.6-38.9,18.2-53.7c15.8-20.2,40.3-33.2,67.8-33.2h649c13.8,0,25-11.2,25-25v-10
		 C920.85,336.6,909.65,325.4,895.85,325.4z"/>
	<path d="M801.65,146.6c0.1-15-5.6-29.2-16.2-40C774.75,95.9,760.65,90,745.55,90h-619.7v112.1h618.7
		 C775.75,202.1,801.35,177.2,801.65,146.6z"/>
	<path d="M96.65,232.1c-13.8,0-25,11.2-25,25v10c0,13.8,11.2,25,25,25h647.5c80.7,0,147.2-64.9,147.5-145.6
		 C891.85,65.7,826.25,0,745.55,0H96.65c-13.8,0-25,11.2-25,25v10c0,13.8,11.2,25,25,25h649c27.5,0,52.1,13,67.8,33.2
		 c11.601,14.8,18.4,33.5,18.2,53.7c-0.2,19.5-7,37.4-18.2,51.7c-16,20.4-41.1,33.5-68.899,33.5H96.65z"/>
      </svg><!--
	      --></button>
	</div>
      </div>
    </div>
  </div>
</div>
{% endif %}
{% endfor %}
{% else %}
<p>{% trans "No story is available that matches your criteria" %}</p>
{% endif %}
<div class="pagination row">
  <div class="col-4 pageChoice" style="text-align:left;">
      {% if stories_list.has_previous %}
      <a href="?page=1"><!--
	--><svg  xmlns="http://www.w3.org/2000/svg" version="1.0" viewBox="0 0 230 240" xmlns="http://www.w3.org/2000/svg" version="1.0" width="230" height="240">
	  <path d="M 120 240 a 1 1 0 0 1 0 -240" />
	  <path d="M 230 240 a 1 1 0 0 1 0 -240" />
	</svg><!--
      --></a>
      <a href="?page={{ stories_list.previous_page_number }}"><!--
	--><svg xmlns="http://www.w3.org/2000/svg" version="1.0" viewBox="0 0 120 240" xmlns="http://www.w3.org/2000/svg" version="1.0" width="120" height="240">
	  <path d="M 120 240 a 1 1 0 0 1 0 -240" />
	</svg><!--
      --></a>
      {% endif %}
  </div>
  <div class="col-4" style="text-align:center;">
    {{ stories_list.number }} / {{ stories_list.paginator.num_pages }}
  </div>
  <div class="col-4 pageChoice" style="text-align:right;">
      {% if stories_list.has_next %}
      <a  href="?page={{ stories_list.next_page_number }}"><!--
	--><svg  xmlns="http://www.w3.org/2000/svg" version="1.0" viewBox="0 0 120 240" xmlns="http://www.w3.org/2000/svg" version="1.0" width="120" height="240">
	  <path d="M 0 240 a 1 1 0 0 0 0 -240" />
	</svg><!--
      --></a>
      <a  href="?page={{ stories_list.paginator.num_pages }}"><!--
	--><svg  xmlns="http://www.w3.org/2000/svg" version="1.0" viewBox="0 0 230 240" xmlns="http://www.w3.org/2000/svg" version="1.0" width="230" height="240">
	  <path d="M 0 240 a 1 1 0 0 0 0 -240" />
	  <path d="M 110 240 a 1 1 0 0 0 0 -240" />
	</svg><!--
      --></a>
      {% endif %}
  </div>
</div>
{% endblock %}


{% block javascript %}
<script src="{% static '/js/library_vote.js' %}"></script>
<script src="{% static '/js/library_userLib.js' %}"></script>
{% endblock javascript %}
  
  
